# SocialNetwork

**SocialNetwork** — это микросервисное приложение, предоставляющее функционал социальной сети. Проект разработан с использованием Java и Spring Boot и включает в себя современные технологии для масштабирования, мониторинга и хранения данных.

## Описание

Проект представляет собой социальную сеть, поддерживающую регистрацию пользователей, взаимодействие между ними, хранение данных и многое другое. Инфраструктура приложения настроена для развёртывания в Kubernetes (K8s) и использует множество современных технологий.

---

## Технологии

- **Backend:**
  - Java 17
  - Spring Boot (Web, Cloud, Security, Data, Kafka)
  - Hibernate (JPA)
  - PostgreSQL
  - Redis
  - Kafka
  - MinIO
  - Prometheus
  - Grafana

- **Оркестрация:**
  - Kubernetes (Minikube)
  - Helm Charts

- **Мониторинг и Логирование:**
  - Prometheus
  - Grafana
  - sl4j + logback
    
- **Тесты**
  - JUnit5
  - Mockito
---
## Функциональные требования

- **Уведомления о:**
  - входе в систему и регистрации
  - изменение email
  - изменение пароля
  - лайке на пост
  - комментарии на пост
- **Профиль**
  - вход в систему и регистрация
  - изменение email
  - изменение пароля
  - просмотр профиля
  - стена пользователя
- **Контент**
  - создание постов
  - возможность ставить лайки
  - возможность писать комментарии
- **Социальное**
  - добавление в друзья
  - возможность делиться постами
---
## Метрики
В проект было добавлено несколько бизнес метрик:
1. Среднее количество постов на одного пользователя
2. Среднее количество комментов на один пост
3. Среднее количество лайков на один пост
4. Количество регистраций

---
## Тесты
- user-service
  - unit
  - компонентные
- post-service
  - unit
  - компонентные

---
## Архитектура
![image](https://github.com/user-attachments/assets/ecdf0c7c-639c-420f-88d1-a9ab841ca6e3)

## Реализация Saga паттерна

В проекте был реализован **Saga паттерн** с использованием **хореографии**, при которой каждый сервис в системе самостоятельно управляет своим состоянием и процессами, передавая события между собой.
Для управления последовательностью событий и координации между сервисами в рамках Saga паттерна использовалась **Kafka** как посредник для передачи событий между микросервисами.

---

## Самописные решения

В проекте используется **самописный Spring Boot starter** для загрузки изображений из S3. Более подробную информацию можно найти по [ссылке на GitHub](https://github.com/SuzdalevAndrey/spring-boot-starter-s3-load-image).

Чтобы добавить этот starter в ваш проект, используйте следующий код в файле `pom.xml`:

```xml
<dependency>
    <groupId>com.github.SuzdalevAndrey</groupId>
    <artifactId>spring-boot-starter-s3-load-image</artifactId>
    <version>v1.0.1</version>
</dependency>
```

---
## Развёртывание

### 1. Локальное развертывание через Docker Compose
1. Убедитесь, что установлены Docker и Docker Compose.
2. Выполните команду:
   ```bash
   docker-compose up --build
   ```

### 2. Развёртывание в Kubernetes
#### Шаги:
1. Установите **Minikube**

2. Выполните команду:
   ```bash
   minikube start
   ```

3. Сделайте файл deploy.sh исполняемым с помощью команды:
   ```bash
   chmod +x deploy.sh
   ```
4. Запустите файл deploy.sh используя команду:
   ```bash
   ./deploy.sh
   ```
---

## Endpoints
1. k8s
  - **Gateway**: `http://social.network.nn.ru`.
  - **Prometheus**: `http://<minikube_ip>:<node_port_prometheus>`.
  - **Grafana**: `http://<minikube_ip>:<node_port_grafana>`.
  - **MinIo**: `http://<minikube_ip>:30001`.
2. docker-compose
  - **Gateway**: `http://localhost:8082`.
  - **Prometheus**: `http://localhost:9090`.
  - **Grafana**: `http://localhost:3000`.
  - **MinIo**: `http://localhost:9091`.

